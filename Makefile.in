# Makefile.in for Jade version 4
# Copyright (C) 1998 John Harper <john@dcs.warwick.ac.uk>
# $Id$
#
# This file is part of Jade.
#
# Jade is free software; you can redistribute it and/or modify it
# under the terms of the GNU General Public License as published by
# the Free Software Foundation; either version 2, or (at your option)
# any later version.
#
# Jade is distributed in the hope that it will be useful, but
# WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License
# along with Jade; see the file COPYING.  If not, write to
# the Free Software Foundation, 675 Mass Ave, Cambridge, MA 02139, USA.

version=@version@
SHELL=/bin/sh

prefix=@prefix@
exec_prefix=@exec_prefix@
datadir=@datadir@
top_srcdir = @top_srcdir@
srcdir = @srcdir@
bindir = @bindir@
includedir=@includedir@
infodir=@infodir@
libdir=@libdir@
libexecdir=@libexecdir@
localstatedir=@localstatedir@
mandir=@mandir@
sharedstatedir=@sharedstatedir@

jadedir=@jadedir@
lispdir=@lispdir@
enable_dumped=@enable_dumped@

INSTALL=@INSTALL@
INSTALL_DATA=@INSTALL_DATA@
INSTALL_PROGRAM=@INSTALL_PROGRAM@

CLEANDIRS = lisp man

ifeq ($(enable_dumped), 0)
 all : lib jade lisp
else
 all : lib jade lisp jaded
endif

.PHONY: jade jaded lisp lib

lib :
	(cd lib && $(MAKE) all)

jade :
	(cd jade && $(MAKE) all)

ifneq ($(enable_dumped), 0)
jaded : jade $(DUMPED_OUT)
	(cd jaded && $(MAKE) all)
endif

NEWS : man/news.texi
	(cd man && $(MAKE) ../NEWS )

install : all installdirs
	$(INSTALL_PROGRAM) src/jade $(bindir)/jade
	$(INSTALL_PROGRAM) src/jadeclient $(bindir)/jadeclient
	(cd man && $(MAKE) install.info)
	(cd lisp && $(MAKE) install)

installdirs :
	$(SHELL) libsrc/mkinstalldirs $(jadedir) $(bindir) $(infodir) \
		 $(lispdir)

uninstall :
	rm -f $(bindir)/jade $(bindir)/jadeclient )
	(cd man && $(MAKE) uninstall.info )
	(cd lisp && $(MAKE) uninstall )
	rm -rf $(jadedir)

lisp :
	(cd lisp && $(MAKE) lisp)

tar :
	tar -zcT FILES -f jade.tar.gz

nobak :
	rm `find . -name '*~' -print`

clean :
	rm -f *~ NEWS
	set -e; for dir in $(CLEANDIRS); do $(MAKE) -C $$dir clean; done

realclean :
	set -e; for dir in $(CLEANDIRS); do $(MAKE) -C $$dir realclean; done
	-[ -d lib ] && rm -rf lib
	-[ -d jade ] && rm -rf jade
	-[ -d jaded ] && rm -rf jaded
	rm -f config.cache config.h config.log config.status Makefile
	rm -f *~ NEWS dump.out DOC
